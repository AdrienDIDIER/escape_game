<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Escape Game - Control Room</title>
<style>
  :root{
    --bg:#0b0e12; --text:#e8f0ff; --muted:#94a3b8;
    --accent:#7c3aed; --accent2:#22c55e;
    --danger:#ef4444; --warn:#f59e0b;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; min-height:100vh;
    padding-bottom: env(safe-area-inset-bottom);
    background: radial-gradient(900px 600px at 20% 10%, rgba(124,58,237,.25), transparent 55%),
                radial-gradient(700px 500px at 80% 90%, rgba(34,197,94,.18), transparent 55%),
                var(--bg);
    color:var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    -webkit-text-size-adjust: 100%;
  }

  header{
    position:sticky; top:0; z-index:5;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    background: rgba(11,14,18,.65);
    border-bottom:1px solid rgba(255,255,255,.06);
  }

  .wrap{max-width:1100px; margin:0 auto; padding:18px 16px;}
  @media (max-width: 520px){ .wrap{padding:14px 12px;} }

  .topbar{
    display:flex; align-items:center; gap:12px; justify-content:space-between;
    flex-wrap:wrap;
  }

  .brand{display:flex; align-items:center; gap:10px; min-width: 240px;}
  .logo{
    width:38px; height:38px; border-radius:12px;
    background: linear-gradient(135deg, rgba(124,58,237,.95), rgba(34,197,94,.85));
    box-shadow: 0 10px 30px rgba(124,58,237,.25);
    flex: 0 0 auto;
  }
  .titleblock{line-height:1.1}
  .titleblock h1{margin:0; font-size:16px; letter-spacing:.6px; text-transform:uppercase}
  .titleblock p{margin:4px 0 0; color:var(--muted); font-size:12px}

  .hud{
    display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end;
    flex: 1 1 280px;
  }
  .pill{
    border:1px solid rgba(255,255,255,.08);
    background: rgba(16,23,35,.65);
    padding:8px 10px; border-radius:999px;
    display:flex; gap:8px; align-items:center; color:var(--muted); font-size:12px;
  }
  .dot{width:8px; height:8px; border-radius:999px; background:var(--accent2); box-shadow:0 0 14px rgba(34,197,94,.35)}
  .dot.warn{background:var(--warn); box-shadow:0 0 14px rgba(245,158,11,.35)}
  .dot.danger{background:var(--danger); box-shadow:0 0 14px rgba(239,68,68,.35)}
  .progress{
    width:220px; height:10px; border-radius:999px;
    background: rgba(255,255,255,.08); overflow:hidden;
    border:1px solid rgba(255,255,255,.08);
  }
  .bar{height:100%; width:0%; background: linear-gradient(90deg, var(--accent), var(--accent2)); transition:width .35s ease;}

  main .wrap{padding-top:22px}

  .grid{
    display:grid; grid-template-columns: 1.35fr .65fr; gap:14px;
  }
  @media (max-width: 980px){
    .grid{grid-template-columns:1fr}
    .progress{width:160px}
  }

  .card{
    border:1px solid rgba(255,255,255,.08);
    background: rgba(16,23,35,.65);
    border-radius:18px;
    overflow:hidden;
  }
  .card .head{
    padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.06);
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    background: linear-gradient(180deg, rgba(255,255,255,.04), transparent);
  }
  .card .head h2{margin:0; font-size:14px; letter-spacing:.4px}
  .card .head small{color:var(--muted)}
  .card .body{padding:16px}
  @media (max-width: 520px){
    .card{border-radius:16px}
    .card .head{padding:12px 12px}
    .card .body{padding:12px}
  }

  .screen{
    background: rgba(10,14,20,.7);
    border:1px solid rgba(255,255,255,.08);
    border-radius:14px;
    padding:14px;
    box-shadow: inset 0 0 0 1px rgba(0,0,0,.2);
  }
  .screen .msg{
    color:var(--muted);
    font-size:13px;
    line-height:1.5;
    white-space:pre-line;
  }

  .glitch{position:relative; display:inline-block; color:var(--text); text-shadow:0 0 18px rgba(124,58,237,.25);}
  .glitch::before,.glitch::after{content: attr(data-text); position:absolute; left:0; top:0; opacity:.6; pointer-events:none;}
  .glitch::before{transform: translate(1px,-1px); color: rgba(34,197,94,.7); clip-path: inset(0 0 55% 0);}
  .glitch::after{transform: translate(-1px,1px); color: rgba(239,68,68,.7); clip-path: inset(55% 0 0 0);}

  .controls{margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
  input[type="text"]{
    flex: 1 1 240px;
    background: rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.12);
    border-radius:12px;
    padding:14px 12px;
    color:var(--text);
    outline:none;
    font-size:16px; /* prevent iOS zoom */
  }
  input[type="text"]::placeholder{color: rgba(148,163,184,.75)}
  .btn{
    border:none; cursor:pointer;
    border-radius:12px;
    padding:14px 14px;
    color:white;
    background: linear-gradient(135deg, rgba(124,58,237,.95), rgba(34,197,94,.85));
    box-shadow: 0 10px 25px rgba(124,58,237,.18);
    font-size:16px;
    touch-action: manipulation;
  }
  .btn.secondary{
    background: rgba(255,255,255,.06);
    color:var(--text);
    border:1px solid rgba(255,255,255,.12);
    box-shadow:none;
  }
  .btn.danger{
    background: rgba(239,68,68,.15);
    border:1px solid rgba(239,68,68,.35);
    box-shadow:none;
  }
  @media (max-width: 520px){
    .controls{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .controls input{grid-column: 1 / -1;}
    .btn{width:100%;}
  }

  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .tag{
    font-size:12px; padding:6px 10px; border-radius:999px;
    border:1px solid rgba(255,255,255,.10);
    color:var(--muted); background: rgba(255,255,255,.04);
  }

  .side .body{display:flex; flex-direction:column; gap:12px}
  .list{display:flex; flex-direction:column; gap:8px}
  .item{
    padding:10px 10px; border-radius:12px;
    background: rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.08);
    display:flex; justify-content:space-between; gap:10px; align-items:center;
  }
  .item b{font-size:13px}
  .item small{color:var(--muted)}
  .divider{height:1px; background: rgba(255,255,255,.06); margin:6px 0}

  /* Mini-game area */
  #miniGame{margin-top:8px}
  input[type="range"]{width:100%; accent-color: var(--accent);}

  /* Modal */
  .modal{
    position:fixed; inset:0; display:none; place-items:center;
    background: rgba(0,0,0,.55); z-index:50;
    padding:16px;
  }
  .modal.show{display:grid}
  .modal .panel{
    width:min(520px, 100%);
    border-radius:18px;
    background: rgba(16,23,35,.92);
    border:1px solid rgba(255,255,255,.10);
    padding:16px;
  }
  .modal .panel h3{margin:4px 0 8px}
  .modal .panel p{margin:0; color:var(--muted); line-height:1.5; white-space:pre-line}
  .modal .panel .row{justify-content:flex-end; margin-top:12px}

  /* ‚úÖ End screen inventory (full) */
  .twoCols{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:12px;
    margin-top:12px;
  }
  @media (max-width: 700px){
    .twoCols{grid-template-columns:1fr;}
  }
  .scrollBox{
    background: rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.08);
    border-radius:14px;
    padding:12px;
    max-height: 260px;
    overflow:auto;
  }
  .scrollBox::-webkit-scrollbar{height:10px;width:10px}
  .scrollBox::-webkit-scrollbar-thumb{background: rgba(255,255,255,.12); border-radius:999px}
  .kRow{
    display:flex; justify-content:space-between; gap:10px; align-items:center;
    padding:10px 10px;
    border-radius:12px;
    background: rgba(255,255,255,.03);
    border:1px solid rgba(255,255,255,.06);
    margin-bottom:8px;
  }
  .kRow:last-child{margin-bottom:0}
  .kRow b{font-size:13px}
  .kRow small{color:var(--muted)}

  /* ‚úÖ Listes scrollables (Journal + Inventaire) */
    .scrollList{
    max-height: 420px;
    overflow: auto;
    padding-right: 4px;
    }

    @media (max-width: 980px){
    .scrollList{ max-height: 320px; }
    }

    .scrollList::-webkit-scrollbar{height:10px;width:10px}
    .scrollList::-webkit-scrollbar-thumb{background: rgba(255,255,255,.12); border-radius:999px}
    </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo"></div>
        <div class="titleblock">
          <h1>CONTROL ROOM</h1>
          <p>Protocole : <span class="glitch" data-text="RETROUVER ADRIEN">RETROUVER ADRIEN</span></p>
        </div>
      </div>
      <div class="hud">
        <div class="pill"><span class="dot" id="statusDot"></span><span id="statusTxt">Lien stable</span></div>
        <div class="pill"><span>Progression</span><div class="progress"><div class="bar" id="bar"></div></div><span id="pct">0%</span></div>
        <div class="pill"><span>Erreurs</span><b id="fails">0</b>/5</div>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <div class="grid">
      <section class="card">
        <div class="head">
          <h2 id="pTitle">Connexion entrante</h2>
          <small id="pType">mode: dialogue</small>
        </div>
        <div class="body">
          <div class="screen">
            <div class="msg" id="msg"></div>
            <div id="miniGame"></div>
          </div>

          <div class="controls" id="qaControls">
            <input type="text" id="answer" placeholder="Tape ta r√©ponse‚Ä¶" autocomplete="off" />
            <button class="btn" id="btnValidate">Valider</button>
            <button class="btn secondary" id="btnHint">Indice</button>
          </div>

          <div class="row" style="margin-top:10px">
            <span class="tag" id="difficultyTag">Difficult√©: ++</span>
            <span class="tag" id="hintTag">Indices: 0/2</span>
            <span class="tag" id="keyTag">Cl√©s: 0</span>
          </div>
        </div>
      </section>

      <aside class="card side">
        <div class="head">
          <h2>Journal & Inventaire</h2>
          <small>notes auto</small>
        </div>
        <div class="body">
          <div>
            <div class="row" style="justify-content:space-between">
              <b>Journal</b><small id="time"></small>
            </div>
            <div class="divider"></div>
            <div class="list scrollList" id="log"></div>
          </div>
          <div>
            <div class="row" style="justify-content:space-between">
              <b>Inventaire</b><small>objets r√©cup√©r√©s</small>
            </div>
            <div class="divider"></div>
            <div class="list scrollList" id="inv"></div>
          </div>
          <button class="btn danger" id="btnReset">Reset (si bug)</button>
        </div>
      </aside>
    </div>
  </div>
</main>

<div class="modal" id="modal">
  <div class="panel">
    <h3 id="mTitle">Indice</h3>
    <p id="mBody"></p>
    <div class="row">
      <button class="btn secondary" id="mClose">OK</button>
    </div>
  </div>
</div>

<script>
const $ = (id)=>document.getElementById(id);
const state = { i:0, fails:0, hintsUsed:0, keys:[], log:[], inv:[] };

const PUZZLES = [
  {
    id:"intro",
    title:"Signal capt√©",
    type:"dialogue",
    difficulty:"+",
    text:[
      "üì° Signal faible‚Ä¶",
      "Je suis coinc√© dans un endroit‚Ä¶ pas cool.",
      "Tu r√©sous des trucs, je reviens dans la r√©alit√©.",
      "Si tu te trompes trop : je finis en stage non r√©mun√©r√© √† vie.",
      "",
      "Pr√™te ? Tape: OK"
    ].join("\n"),
    answer:(a)=>norm(a)==="ok",
    hint:["C‚Äôest litt√©ralement 'OK'.","Oui oui, juste OK üòÑ"],
    reward:{ key:"INIT" }
  },
  {
    id:"caesar",
    title:"Module de d√©chiffrement",
    type:"crypto",
    difficulty:"++",
    text:[
      "üîê Message chiffr√© (C√©sar +3) :",
      "",
      "  'FUBSWR'",
      "",
      "D√©chiffre-le."
    ].join("\n"),
    answer:(a)=>norm(a)==="crypto",
    hint:["C√©sar +3 => tu recules de 3 lettres.","F‚ÜíC, U‚ÜíR‚Ä¶"],
    reward:{ item:"Mot-cl√©: CRYPTO", key:"C3" }
  },
  {
    id:"sequence",
    title:"Calculateur instable",
    type:"logique",
    difficulty:"++",
    text:[
      "üß† Suite :",
      "2, 6, 12, 20, 30, ?",
      "",
      "Donne le prochain nombre."
    ].join("\n"),
    answer:(a)=>norm(a)==="42",
    hint:["Regarde n√ó(n+1).","6√ó7 = ?"],
    reward:{ item:"Nombre: 42", key:"S42" }
  },

  /* ‚úÖ Mini-jeu EASY (slider) */
  {
    id:"unlock",
    title:"Verrou biom√©trique",
    type:"mini-jeu",
    difficulty:"++",
    text:[
      "üîì Mini-jeu : d√©verrouille le sas.",
      "Fais glisser le curseur jusqu‚Äô√† 100%.",
      "",
      "Si tu t‚Äôarr√™tes avant, le sas se moque de toi üòå"
    ].join("\n"),
    init:()=>{
      $("miniGame").innerHTML = `
        <div style="margin-top:12px">
          <div class="row" style="justify-content:space-between; margin-bottom:8px">
            <span class="tag">Mini-jeu: Slide to unlock</span>
            <span class="tag" id="unlockPct">0%</span>
          </div>
          <input id="unlockRange" type="range" min="0" max="100" value="0">
          <div style="margin-top:10px; color: var(--muted); font-size: 13px; line-height:1.4">
            Astuce : va d‚Äôun geste jusqu‚Äôau bout üòâ
          </div>
        </div>
      `;
      $("answer").value="";
      $("answer").placeholder="Mini-jeu : utilise le slider üôÇ";
      $("answer").disabled=true;
      $("btnValidate").textContent="Valider (sas)";

      const range = document.getElementById("unlockRange");
      const pct = document.getElementById("unlockPct");
      range.addEventListener("input", ()=>{
        pct.textContent = range.value + "%";
        if (+range.value >= 100) pct.textContent = "100% ‚úÖ";
      });
    },
    answer:()=>{
      const range = document.getElementById("unlockRange");
      return range && +range.value >= 100;
    },
    onPass:()=>{
      $("answer").disabled=false;
      $("answer").placeholder="Tape ta r√©ponse‚Ä¶";
      $("btnValidate").textContent="Valider";
      $("miniGame").innerHTML="";
    },
    hint:["Il faut aller jusqu‚Äô√† 100%.","Oui, vraiment 100% üòÑ"],
    reward:{ item:"Acc√®s: SAS OUVERT", key:"U1" }
  },

  {
    id:"anagram",
    title:"Terminal linguistique",
    type:"anagramme",
    difficulty:"++",
    text:[
      "üî§ Anagramme :",
      "",
      "  'E N I G M E'",
      "",
      "R√©arrange pour former un mot."
    ].join("\n"),
    answer:(a)=>norm(a)==="enigme",
    hint:["C‚Äôest le mot du jeu üòè","M√™me lettres, bon ordre."],
    reward:{ item:"Mot: ENIGME", key:"A1" }
  },
  {
    id:"riddle",
    title:"Sas philosophique",
    type:"√©nigme",
    difficulty:"++",
    text:[
      "üß© Je grandis quand on m‚Äôenl√®ve.",
      "Je suis quoi ?"
    ].join("\n"),
    answer:(a)=>{ const x=norm(a); return x==="trou"||x==="un trou"; },
    hint:["Pense √† quelque chose qu‚Äôon creuse.","Plus on enl√®ve, plus √ßa grandit."],
    reward:{ item:"Concept: TROU", key:"R0" }
  },
  {
    id:"final",
    title:"Coordonn√©es de retour",
    type:"final",
    difficulty:"+++",
    text:[
      "üõ∞Ô∏è Finale : entre le CODE DE RETOUR.",
      "",
      "R√®gle : concat√®ne les cl√©s dans l‚Äôordre o√π tu les as gagn√©es, sans espaces.",
      "Exemple : INITC3S42U1A1R0",
      "",
      "Entre le code."
    ].join("\n"),
    answer:(a)=> norm(a)===norm(state.keys.join("")),
    hint:["Regarde l‚Äôinventaire des 'Cl√©s'.","C‚Äôest juste la suite : INIT + ..."],
    reward:{ win:true }
  }
];

function norm(s){
  return (s??"").toString().trim().toLowerCase().replaceAll("‚Äô","'").replace(/\s+/g," ");
}

function nowTime(){
  const d=new Date();
  return d.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});
}
function pushLog(text){ state.log.unshift({t:nowTime(), text}); renderLog(); }
function addInv(label,value){ state.inv.unshift({label,value}); renderInv(); }

function setStatus(level){
  const dot=$("statusDot"), txt=$("statusTxt");
  dot.className="dot";
  if(level==="ok") txt.textContent="Lien stable";
  if(level==="warn"){ dot.classList.add("warn"); txt.textContent="Lien instable"; }
  if(level==="danger"){ dot.classList.add("danger"); txt.textContent="Lien critique"; }
}

function showModal(title, body){
  $("mTitle").textContent=title;
  $("mBody").textContent=body;
  $("modal").classList.add("show");
}
function closeModal(){ $("modal").classList.remove("show"); }

function updateHUD(){
  $("fails").textContent=state.fails;
  $("time").textContent="üïí "+nowTime();
  const pct=Math.round((state.i/(PUZZLES.length-1))*100);
  $("bar").style.width=Math.min(100,pct)+"%";
  $("pct").textContent=Math.min(100,pct)+"%";
  $("keyTag").textContent="Cl√©s: "+state.keys.length;
  $("hintTag").textContent="Indices: "+state.hintsUsed+"/2";

  if(state.fails<=1) setStatus("ok");
  else if(state.fails<=3) setStatus("warn");
  else setStatus("danger");
}

function currentPuzzle(){ return PUZZLES[state.i]; }

function render(){
  const p=currentPuzzle();
  $("pTitle").textContent=p.title;
  $("pType").textContent="mode: "+p.type;
  $("difficultyTag").textContent="Difficult√©: "+p.difficulty;
  $("msg").textContent=p.text;

  $("miniGame").innerHTML="";
  $("answer").disabled=false;
  $("answer").placeholder="Tape ta r√©ponse‚Ä¶";
  $("btnValidate").textContent="Valider";

  if(p.init) p.init();
  updateHUD();
}

function reward(p){
  if(p.reward?.key){ state.keys.push(p.reward.key); addInv("üîë Cl√©", p.reward.key); }
  if(p.reward?.item){ addInv("üì¶ Objet", p.reward.item); }
  if(p.reward?.win){ winScreen(); }
}

function next(){
  state.i++;
  if(state.i>=PUZZLES.length) state.i=PUZZLES.length-1;
  render();
}

function fail(){
  state.fails++;
  updateHUD();
  pushLog("‚ùå Mauvaise r√©ponse. (Indice: le monde est cruel.)");
  if(state.fails>=5){
    showModal("üíÄ √âchec critique","Trop d‚Äôerreurs‚Ä¶ Je suis en colocation avec un rat.\n\nOn recommence.");
    resetAll();
  } else {
    showModal("üò± Non","Mauvaise r√©ponse.\n\nJe suis toujours perdu.\n(Encore "+(5-state.fails)+" erreurs max.)");
  }
}

function pass(){
  const p = currentPuzzle();

  // ‚úÖ clear le champ UNIQUEMENT si c‚Äôest bon
  $("answer").value = "";

  pushLog("‚úÖ " + p.title + " r√©solu.");
  reward(p);

  if(p.onPass) p.onPass();
  if(!p.reward?.win) next();
}

function check(){
  const p=currentPuzzle();
  const a=$("answer").value;
  let ok=false;
  try{ ok = (typeof p.answer==="function") ? p.answer(a) : norm(a)===norm(p.answer); }
  catch(e){ ok=false; }
  ok ? pass() : fail();
}

function hint(){
  if(state.hintsUsed>=2){ showModal("üß† Indice","Plus d‚Äôindices. Fais confiance √† ton cerveau üòè"); return; }
  const p=currentPuzzle();
  const hintList=p.hint ?? ["Aucun indice."];
  const h=hintList[Math.min(state.hintsUsed, hintList.length-1)];
  state.hintsUsed++;
  updateHUD();
  showModal("üß† Indice", h);
}

function winScreen(){
  const allKeys = state.keys.slice();
  const allInv  = state.inv.slice();
  const code = escapeHtml(state.keys.join(""));

  const keysHtml = allKeys.length
    ? allKeys.map((k, idx)=>`
        <div class="kRow">
          <div><b>üîë Cl√© #${idx+1}</b><div><small>${escapeHtml(k)}</small></div></div>
          <small>KEY</small>
        </div>
      `).join("")
    : `<div class="kRow"><div><b>‚Äî</b><div><small>Aucune cl√©</small></div></div><small>KEY</small></div>`;

  const invHtml = allInv.length
    ? allInv.map((e)=>`
        <div class="kRow">
          <div><b>${escapeHtml(e.label)}</b><div><small>${escapeHtml(e.value)}</small></div></div>
          <small>INV</small>
        </div>
      `).join("")
    : `<div class="kRow"><div><b>‚Äî</b><div><small>Aucun objet</small></div></div><small>INV</small></div>`;

  document.querySelector("main .wrap").innerHTML = `
    <section class="card" style="max-width:900px;margin:0 auto;">
      <div class="head">
        <h2>üéâ RETOUR √Ä LA R√âALIT√â</h2>
        <small>protocole termin√©</small>
      </div>
      <div class="body">
        <div class="screen">
          <div class="msg">
Bravo, tu m‚Äôas retrouv√© üò≠‚ù§Ô∏è

R√©compenses :
- Un c√¢lin obligatoire (non n√©gociable)
- Un rendez-vous surprise üòè
- Et le droit de te moquer de moi

Code de retour (pour la gloire) :
${code}
          </div>
        </div>

        <div class="twoCols">
          <div>
            <div class="row" style="justify-content:space-between; margin: 10px 0 8px;">
              <b>üîë Toutes les cl√©s</b><small>${allKeys.length}</small>
            </div>
            <div class="scrollBox">${keysHtml}</div>
          </div>

          <div>
            <div class="row" style="justify-content:space-between; margin: 10px 0 8px;">
              <b>üì¶ Inventaire complet</b><small>${allInv.length}</small>
            </div>
            <div class="scrollBox">${invHtml}</div>
          </div>
        </div>

        <div class="controls" style="justify-content:center; margin-top:14px;">
          <button class="btn secondary" onclick="navigator.clipboard?.writeText('${code}')">Copier le code</button>
          <button class="btn" onclick="location.reload()">Rejouer</button>
        </div>
      </div>
    </section>
  `;
}

function renderLog(){
  const root=$("log"); root.innerHTML="";
  const slice=state.log.slice(0,8);
  if(slice.length===0){
    root.innerHTML=`<div class="item"><div><b>‚Äî</b><div><small>Rien pour le moment</small></div></div><small>LOG</small></div>`;
    return;
  }
  slice.forEach(e=>{
    const div=document.createElement("div");
    div.className="item";
    div.innerHTML=`<div><b>${e.t}</b><div><small>${escapeHtml(e.text)}</small></div></div><small>LOG</small>`;
    root.appendChild(div);
  });
}
function renderInv(){
  const root = $("inv");
  root.innerHTML = "";

  if(state.inv.length === 0){
    root.innerHTML = `<div class="item"><div><b>‚Äî</b><div><small>Aucun objet</small></div></div><small>INV</small></div>`;
    return;
  }

  // ‚úÖ Affiche TOUT l‚Äôinventaire
  state.inv.forEach(e=>{
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `<div><b>${escapeHtml(e.label)}</b><div><small>${escapeHtml(e.value)}</small></div></div><small>+</small>`;
    root.appendChild(div);
  });
}

function escapeHtml(s){
  return (s??"").toString()
    .replaceAll("&","&amp;").replaceAll("<","&lt;")
    .replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");
}

/* Reset */
function resetAll(){
  state.i=0; state.fails=0; state.hintsUsed=0; state.keys=[];
  state.log=[]; state.inv=[];
  render();
}

$("btnValidate").addEventListener("click", check);
$("btnHint").addEventListener("click", hint);
$("btnReset").addEventListener("click", ()=>{ showModal("Reset","OK, on recommence proprement."); resetAll(); });
$("mClose").addEventListener("click", closeModal);
$("modal").addEventListener("click", (e)=>{ if(e.target.id==="modal") closeModal(); });
$("answer").addEventListener("keydown", (e)=>{ if(e.key==="Enter") check(); });

pushLog("Connexion √©tablie. Protocole pr√™t.");
render();
setInterval(()=>updateHUD(), 1000);
</script>
</body>
</html>
